<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é›™äººå°è©±è½åŠ› V5.0</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@600&family=Zen+Maru+Gothic:wght@500;700&display=swap" rel="stylesheet">

    <style>
        /* --- åŸºç¤è¨­å®š --- */
        :root { --bg: #f4f4f4; --card: #fff; --primary: #555; --text: #333; --border: #ccc; --radius: 12px; --font: 'Microsoft JhengHei', sans-serif; }
        body { margin: 0; padding: 20px; padding-bottom: 60px; font-family: var(--font); background: var(--bg); color: var(--text); display: flex; flex-direction: column; align-items: center; min-height: 100vh; transition: 0.3s; }
        .container { background: var(--card); padding: 30px; width: 95%; max-width: 800px; border-radius: var(--radius); border: 2px solid var(--border); box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin-bottom: 20px; position: relative; }
        .btn { background: var(--primary); color: #fff; border: none; padding: 10px 20px; border-radius: 50px; cursor: pointer; font-size: 15px; margin: 5px; font-family: inherit; transition: 0.2s; box-shadow: 0 4px 0 rgba(0,0,0,0.2); }
        .btn:active { transform: translateY(3px); box-shadow: none; } .btn:hover { filter: brightness(1.1); }
        .btn-add { background: #4CAF50; } .btn-del { background: #E57373; padding: 5px 10px; font-size: 12px; margin-left: 5px;}
        input[type="text"], textarea, select { width: 100%; padding: 10px; margin: 5px 0; border: 1px solid var(--border); border-radius: 6px; box-sizing: border-box; font-size: 15px; font-family: inherit; }

        /* --- æ•™å­¸æŒ‡å¼•å€å¡Š (æ–°å¢) --- */
        .instruction-box { 
            background: #E3F2FD; border-left: 5px solid #2196F3; padding: 15px; margin-bottom: 20px; border-radius: 4px; font-size: 15px; line-height: 1.6; color: #333;
        }
        .instruction-box h3 { margin: 0 0 5px 0; color: #1565C0; font-size: 18px; }
        .code-tag { background: #fff; padding: 2px 6px; border-radius: 4px; font-family: monospace; color: #D32F2F; font-weight: bold; border: 1px solid #ccc; }
        .role-badge { display: inline-block; padding: 2px 8px; border-radius: 10px; font-size: 12px; color: white; margin: 0 2px; }

        /* å‡ºé¡Œå€ */
        .q-block { background: rgba(0,0,0,0.03); padding: 20px; border-radius: 10px; margin-bottom: 20px; border: 1px dashed var(--border); }
        .script-row { display: flex; gap: 5px; align-items: center; margin-bottom: 5px; }
        
        /* è§’è‰²é¸æ“‡å™¨æ¨£å¼å„ªåŒ– */
        .role-select { width: 90px; font-weight: bold; border-width: 2px; }
        .role-select option { font-weight: bold; }
        /* è§’è‰² A (è—è‰²ç³») */
        .role-select.role-a { background: #E8EAF6; border-color: #3F51B5; color: #1A237E; }
        /* è§’è‰² B (æ©˜è‰²ç³») */
        .role-select.role-b { background: #FFF3E0; border-color: #FF9800; color: #E65100; }

        .line-input { flex: 1; }
        .label-text { font-weight: bold; font-size: 14px; color: #666; margin-top: 15px; display: block; }
        .option-row { display: flex; gap: 10px; align-items: center; margin-bottom: 5px; }

        /* ç­”é¡Œå€ */
        .audio-box { text-align: center; background: rgba(0,0,0,0.05); padding: 20px; border-radius: var(--radius); margin-bottom: 20px; }
        .status-text { font-size: 16px; color: #333; margin-bottom: 15px; min-height: 24px; font-weight: bold; color: var(--primary); }
        .options-grid { display: grid; grid-template-columns: 1fr; gap: 12px; width: 100%; margin-top: 10px; }
        .option-btn { background: #fff; border: 2px solid var(--primary); color: var(--text); padding: 15px; border-radius: 10px; font-size: 18px; cursor: pointer; transition: 0.2s; text-align: left; display: flex; align-items: center; }
        .option-btn:hover { background: rgba(0,0,0,0.05); transform: translateX(5px); }
        .option-btn .abc { font-weight: bold; margin-right: 15px; background: var(--primary); color: #fff; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; }
        .option-btn.correct { background: #C8E6C9; border-color: #4CAF50; } .option-btn.wrong { background: #FFCDD2; border-color: #F44336; }

        .footer-credit { position: fixed; bottom: 0; left: 0; width: 100%; background: rgba(255,255,255,0.95); text-align: center; padding: 10px 0; font-size: 14px; color: #666; border-top: 1px solid #ddd; z-index: 999; }
        .footer-credit span { font-weight: bold; color: #333; }
        
        /* é¢¨æ ¼å®šç¾© (çœç•¥éƒ¨åˆ†ä»¥ç¯€çœç¯‡å¹…ï¼Œä¿æŒ V4 é¢¨æ ¼) */
        body.style-morandi { --bg: #D8E2DC; --card: #F9F7F2; --primary: #9D8189; --text: #6D6875; --border: #B5B2BE; --radius: 12px; }
        body.style-wood { --bg: #EFEBE9; --card: #FFF3E0; --primary: #8D6E63; --text: #3E2723; --border: #D7CCC8; --radius: 8px; background-image: repeating-linear-gradient(45deg, #EFEBE9 0, #EFEBE9 10px, #D7CCC8 10px, #D7CCC8 12px); }
        body.style-tech { --bg: #ECEFF1; --card: #FFF; --primary: #0097A7; --text: #37474F; --border: #B2EBF2; --radius: 4px; }
        body.style-sky { --bg: #E1F5FE; --card: #FFF; --primary: #4FC3F7; --text: #0277BD; --border: #B3E5FC; --radius: 20px; background-image: radial-gradient(#FFF 20%, transparent 20%); background-size: 20px 20px; }
        body.style-chalk { --bg: #263238; --card: #37474F; --primary: #FFCC80; --text: #FFF; --border: #546E7A; --radius: 6px; }
        body.style-chalk input, body.style-chalk textarea { background: #455A64; color: white; border: 1px solid #78909C; }
        body.style-chalk .option-btn { background: transparent; color: white; border-color: #FFCC80; }

        .hidden { display: none !important; }
        .stamp { position: absolute; right: 20px; bottom: 20px; font-size: 40px; border: 3px solid #D32F2F; color: #D32F2F; padding: 15px; transform: rotate(-15deg); border-radius: 50%; opacity: 0.8; font-weight: bold; background: rgba(255,255,255,0.8); }
    </style>
</head>
<body class="style-morandi">

    <div class="footer-credit">Designed by <span>å°å¸«å¤§å³ç©ç´”è€å¸«</span> | Powered by AI Tool</div>

    <h1 id="page-title">ğŸ§ é›™äººå°è©±è½åŠ› V5</h1>

    <div id="teacher-setup" class="container">
        <h2>âœï¸ è€å¸«å‡ºé¡Œå€</h2>
        
        <div class="instruction-box">
            <h3>ğŸ“– å‡ºé¡Œå°æ’‡æ­¥ï¼š</h3>
            <ul>
                <li><b>è§’è‰²åˆ†é…ï¼š</b> 
                    <span class="role-badge" style="background:#3F51B5;">è§’è‰² A</span> è²éŸ³è¼ƒä½æ²‰ï¼ˆé©åˆç•¶ç”·è²æˆ–é•·è¼©ï¼‰ï¼›
                    <span class="role-badge" style="background:#FF9800;">è§’è‰² B</span> è²éŸ³è¼ƒé«˜äº¢ï¼ˆé©åˆç•¶å¥³è²æˆ–å°å­©ï¼‰ã€‚
                </li>
                <li><b>ç ´éŸ³å­—ä¿®æ­£ï¼š</b> å¦‚æœé›»è…¦å¿µéŒ¯éŸ³ï¼Œè«‹ç”¨ <span class="code-tag">{é¡¯ç¤ºå­—|åŒéŸ³å­—}</span> æ ¼å¼ã€‚<br>
                    ç¯„ä¾‹ï¼šè¼¸å…¥ <span class="code-tag">æˆ‘è¦å»éŠ€{è¡Œ|èˆª}</span>ï¼Œé›»è…¦å°±æœƒæ­£ç¢ºå¿µå‡ºã€Œèˆªã€çš„éŸ³ã€‚
                </li>
                <li><b>å¢åŠ å°è©±ï¼š</b> é»æ“Šã€Œ+ å¢åŠ ä¸€å¥ã€å¯ä»¥å»¶é•·å°è©±å…§å®¹ã€‚</li>
            </ul>
        </div>

        <label>1. é¸æ“‡é¢¨æ ¼</label>
        <select id="input-style" onchange="previewStyle()">
            <option value="style-morandi">1. è«è˜­è¿ª Morandi</option>
            <option value="style-wood">2. æº«æš–æœ¨è³ª Wood</option>
            <option value="style-tech">3. ç§‘æŠ€è—èª¿ Tech</option>
            <option value="style-sky">4. å¯æ„›å¤©ç©º Sky</option>
            <option value="style-chalk">5. æ•™å®¤é»‘æ¿ Chalkboard</option>
        </select>
        <label>2. ä½œæ¥­æ¨™é¡Œ</label>
        <input type="text" id="input-title" placeholder="ä¾‹å¦‚ï¼šç¬¬äº”èª² å°è©±ç·´ç¿’">
        <hr style="border:0; border-top:1px dashed var(--border); margin:20px 0;">
        <div id="questions-wrapper"></div>
        <button class="btn btn-add" onclick="addQuestion()">+ å¢åŠ ä¸€é¡Œ</button>
        <span style="font-size:12px; color:#888;">(æœ€å¤š10é¡Œ)</span>
        <br><br>
        <button class="btn" onclick="generateLink()">âœ¨ ç”¢ç”Ÿä½œæ¥­é€£çµ</button>
        <div id="result-box" class="hidden" style="margin-top:20px; padding:15px; border:1px solid var(--border); background: rgba(255,255,255,0.5);">
            <p>âœ… ç¶²å€å·²ç”Ÿæˆï¼š</p>
            <textarea id="generated-link" style="height:60px; font-size:12px;" readonly></textarea>
            <button class="btn" onclick="copyLink()">ğŸ“‹ è¤‡è£½ç¶²å€</button>
            <button class="btn" onclick="testPlay()">ğŸ® è©¦ç©</button>
        </div>
    </div>

    <div id="student-login" class="container hidden" style="text-align:center;">
        <h2 id="login-title">æº–å‚™é–‹å§‹</h2>
        <p>è«‹è¼¸å…¥åå­—ï¼š</p>
        <input type="text" id="student-name" placeholder="Name" style="text-align:center; font-size:18px;">
        <br><br>
        <button class="btn" onclick="startQuiz()">ğŸš€ é–‹å§‹æ¸¬é©—</button>
    </div>

    <div id="game-area" class="container hidden">
        <div style="display:flex; justify-content:space-between; font-weight:bold;">
            <span id="display-name"></span>
            <span>ç¬¬ <span id="current-q">1</span> / <span id="total-q">10</span> é¡Œ</span>
        </div>
        <hr style="border-top: 1px solid var(--border); margin: 15px 0;">
        <div class="audio-box">
            <div style="font-size:50px; margin-bottom:10px;">ğŸ”Š</div>
            <div id="status-text" class="status-text">é»æ“ŠæŒ‰éˆ•é–‹å§‹æ’­æ”¾</div>
            <div style="margin-top:15px;">
                <button id="play-btn-normal" class="btn" onclick="playDialogue(1)">â–¶ï¸ æ­£å¸¸é€Ÿåº¦</button>
                <button id="play-btn-slow" class="btn" style="background:#00897B;" onclick="playDialogue(0.75)">ğŸ¢ æ…¢é€Ÿ (0.75x)</button>
            </div>
        </div>
        <p style="text-align:center; font-size:14px; color:#666;">è«‹é¸å‡ºæ­£ç¢ºç­”æ¡ˆï¼š</p>
        <div class="options-grid" id="options-area"></div>
        <div id="feedback" style="text-align:center; height:30px; margin-top:10px; font-weight:bold;"></div>
    </div>

    <div id="result-area" class="container hidden" style="text-align:center;">
        <div style="font-size:80px; margin-bottom:10px;">ğŸ†</div>
        <h2>å®Œæˆæ¸¬é©—ï¼</h2>
        <h3 id="result-title-display"></h3>
        <p>å§“åï¼š<strong id="result-name" style="font-size:24px;"></strong></p>
        <div style="font-size:60px; font-weight:bold; color:var(--primary); margin:20px;">
            <span id="final-score">100</span> <span style="font-size:20px;">åˆ†</span>
        </div>
        <p>æ—¥æœŸï¼š<span id="finish-date"></span></p>
        <div class="stamp">å°å¸«å¤§èªè­‰</div>
        <p style="color:var(--primary); font-size:14px;">(è«‹æˆªåœ–å›å‚³)</p>
    </div>

    <script>
        const maxQuestions = 10;
        let questionCount = 0;
        let questionsData = [];
        let currentIdx = 0;
        let score = 0;
        let studentName = "";
        let settings = { title: "å°è©±è½åŠ›", style: "style-morandi" };
        const correctSound = new Audio('https://raw.githubusercontent.com/Arza-3d/ar3.js/master/assets/audio/success.mp3');
        const victorySound = new Audio('https://raw.githubusercontent.com/Arza-3d/ar3.js/master/assets/audio/victory.mp3');

        // --- æ ¸å¿ƒï¼šç³¾éŸ³è§£æå™¨ ---
        function getSpeechText(text) { return text.replace(/\{(.+?)\|(.+?)\}/g, '$2'); }
        function getDisplayText(text) { return text.replace(/\{(.+?)\|(.+?)\}/g, '$1'); }

        // --- 1. å‡ºé¡Œé‚è¼¯ ---
        function addQuestion() {
            if (questionCount >= maxQuestions) return alert("æœ€å¤š 10 é¡Œï¼");
            questionCount++;
            const wrapper = document.getElementById('questions-wrapper');
            const div = document.createElement('div');
            div.className = 'q-block';
            div.innerHTML = `
                <h3>ç¬¬ ${questionCount} é¡Œ</h3>
                <span class="label-text">å°è©±è…³æœ¬ï¼š</span>
                <div class="script-container" id="script-container-${questionCount}"></div>
                <button class="btn btn-add" style="font-size:12px; padding:5px 10px;" onclick="addScriptLine(${questionCount})">+ å¢åŠ ä¸€å¥</button>
                <span class="label-text">å•é¡Œï¼š</span>
                <input type="text" class="input-question" placeholder="ä¾‹å¦‚ï¼šè«‹å•è§’è‰² A è¦ºå¾—æ€éº¼æ¨£ï¼Ÿ">
                <span class="label-text">é¸é …ï¼š</span>
                <div class="option-row"><input type="radio" name="q${questionCount}" value="0" checked> <input type="text" class="opt-0" placeholder="é¸é … A"></div>
                <div class="option-row"><input type="radio" name="q${questionCount}" value="1"> <input type="text" class="opt-1" placeholder="é¸é … B"></div>
                <div class="option-row"><input type="radio" name="q${questionCount}" value="2"> <input type="text" class="opt-2" placeholder="é¸é … C"></div>
                <div class="option-row"><input type="radio" name="q${questionCount}" value="3"> <input type="text" class="opt-3" placeholder="é¸é … D"></div>
            `;
            wrapper.appendChild(div);
            addScriptLine(questionCount); addScriptLine(questionCount);
        }

        function addScriptLine(qId) {
            const container = document.getElementById(`script-container-${qId}`);
            const div = document.createElement('div');
            div.className = 'script-row';
            // æ”¹æˆ Role A / Role B
            div.innerHTML = `
                <select class="role-select role-a" onchange="changeRoleColor(this)">
                    <option value="a">è§’è‰² A</option>
                    <option value="b">è§’è‰² B</option>
                </select>
                <input type="text" class="line-input" placeholder="å°è©...">
                <button class="btn btn-del" onclick="this.parentElement.remove()">x</button>
            `;
            container.appendChild(div);
        }

        function changeRoleColor(select) {
            // æ ¹æ“šé¸æ“‡åˆ‡æ›é¡è‰²
            if(select.value === 'b') {
                select.classList.remove('role-a');
                select.classList.add('role-b');
            } else {
                select.classList.remove('role-b');
                select.classList.add('role-a');
            }
        }

        window.addEventListener('DOMContentLoaded', () => {
            if(!window.location.search.includes('data=')) addQuestion();
            checkUrlData();
            window.speechSynthesis.getVoices();
        });

        function previewStyle() { document.body.className = document.getElementById('input-style').value; }

        function generateLink() {
            const title = document.getElementById('input-title').value.trim() || "è½åŠ›æ¸¬é©—";
            const style = document.getElementById('input-style').value;
            const qBlocks = document.querySelectorAll('.q-block');
            let qList = [];
            qBlocks.forEach((block, idx) => {
                const scriptRows = block.querySelectorAll('.script-row');
                let dialogue = [];
                scriptRows.forEach(row => {
                    const role = row.querySelector('.role-select').value;
                    const text = row.querySelector('.line-input').value.trim();
                    if(text) dialogue.push({r: role, t: text});
                });
                const question = block.querySelector('.input-question').value.trim();
                const opts = [
                    block.querySelector('.opt-0').value.trim(), block.querySelector('.opt-1').value.trim(),
                    block.querySelector('.opt-2').value.trim(), block.querySelector('.opt-3').value.trim()
                ];
                const correct = block.querySelector(`input[name="q${idx+1}"]:checked`).value;
                if (dialogue.length > 0 && opts[0]) qList.push({ d: dialogue, q: question, o: opts, a: parseInt(correct) });
            });
            if (qList.length < 1) return alert("è«‹è‡³å°‘è¼¸å…¥ä¸€é¡Œ");
            const pack = { s: { title, style }, q: qList };
            const compressed = LZString.compressToEncodedURIComponent(JSON.stringify(pack));
            const url = `${window.location.href.split('?')[0]}?data=${compressed}`;
            document.getElementById('result-box').classList.remove('hidden');
            document.getElementById('generated-link').value = url;
        }

        function copyLink() {
            document.getElementById('generated-link').select();
            document.execCommand('copy');
            alert("å·²è¤‡è£½");
        }
        function testPlay() { window.location.href = document.getElementById('generated-link').value; }

        function checkUrlData() {
            const params = new URLSearchParams(window.location.search);
            const data = params.get('data');
            if (data) {
                try {
                    const decoded = JSON.parse(LZString.decompressFromEncodedURIComponent(data));
                    questionsData = decoded.q; settings = decoded.s;
                    enterStudentMode();
                } catch (e) { console.error(e); }
            } else {
                document.getElementById('teacher-setup').classList.remove('hidden');
                previewStyle();
            }
        }

        function enterStudentMode() {
            document.getElementById('teacher-setup').classList.add('hidden');
            document.getElementById('student-login').classList.remove('hidden');
            document.body.className = settings.style;
            document.getElementById('login-title').innerText = settings.title;
        }

        function startQuiz() {
            const n = document.getElementById('student-name').value.trim();
            if (!n) return alert("è«‹è¼¸å…¥åå­—");
            studentName = n;
            document.getElementById('student-login').classList.add('hidden');
            document.getElementById('game-area').classList.remove('hidden');
            document.getElementById('display-name').innerText = n;
            document.getElementById('total-q').innerText = questionsData.length;
            currentIdx = 0; score = 0; loadQuestion();
        }

        function loadQuestion() {
            if (currentIdx >= questionsData.length) { showResult(); return; }
            document.getElementById('current-q').innerText = currentIdx + 1;
            const q = questionsData[currentIdx];
            const area = document.getElementById('options-area');
            area.innerHTML = "";
            document.getElementById('feedback').innerText = "";
            document.getElementById('status-text').innerText = "æº–å‚™å¥½è«‹é»æ“Šæ’­æ”¾";
            document.getElementById('play-btn-normal').disabled = false;
            document.getElementById('play-btn-slow').disabled = false;
            
            const labels = ["A", "B", "C", "D"];
            q.o.forEach((optText, idx) => {
                if(!optText) return; 
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                // é¸é …æ–‡å­—åªé¡¯ç¤ºã€Œå·¦é‚Šã€çš„å­—
                btn.innerHTML = `<span class="abc">${labels[idx]}</span> ${getDisplayText(optText)}`;
                btn.onclick = () => checkAnswer(idx, btn);
                area.appendChild(btn);
            });
        }

        // --- æ ¸å¿ƒï¼šå„ªåŒ–ç‰ˆæ’­æ”¾å™¨ ---
        let isPlaying = false;
        
        async function playDialogue(speedMultiplier) {
            if(isPlaying) return;
            isPlaying = true;
            document.getElementById('play-btn-normal').disabled = true;
            document.getElementById('play-btn-slow').disabled = true;
            
            const q = questionsData[currentIdx];
            const status = document.getElementById('status-text');
            window.speechSynthesis.cancel();

            // 1. æ’­æ”¾å°è©± (ä½¿ç”¨ç³¾éŸ³è§£æ)
            for (let i = 0; i < q.d.length; i++) {
                const line = q.d[i];
                // é¡¯ç¤º è§’è‰² A / è§’è‰² B
                const roleName = line.r === 'a' ? "è§’è‰² A" : "è§’è‰² B";
                status.innerText = `ğŸ”Š ${roleName} èªªè©±ä¸­...`;
                
                // å‚³å…¥ role 'a' æˆ– 'b'
                await speakPromise(getSpeechText(line.t), line.r, speedMultiplier);
                await new Promise(r => setTimeout(r, 400));
            }

            status.innerText = "...";
            await new Promise(r => setTimeout(r, 1000));

            // 2. æ’­æ”¾å•é¡Œ
            status.innerText = "ğŸ”Š è«‹å•...";
            await speakPromise("è«‹å•ï¼š" + getSpeechText(q.q), 'b', speedMultiplier); // å•é¡Œé€šå¸¸ç”¨æ¯”è¼ƒæ¸…æ™°çš„è²éŸ³(B)
            
            status.innerText = "è«‹ä½œç­”";
            isPlaying = false;
            document.getElementById('play-btn-normal').disabled = false;
            document.getElementById('play-btn-slow').disabled = false;
        }

        function speakPromise(text, role, speedMultiplier) {
            return new Promise((resolve) => {
                const u = new SpeechSynthesisUtterance(text);
                u.lang = 'zh-TW';
                let baseRate = 1.0; let basePitch = 1.0;
                
                // --- è§’è‰² A/B è²éŸ³è¨­å®š ---
                // A: ä½æ²‰ (æ¨¡æ“¬ç”·è²/é•·è¼©)
                if (role === 'a') { basePitch = 0.6; baseRate = 0.85; } 
                // B: é«˜äº¢ (æ¨¡æ“¬å¥³è²/å°å­©/æ—ç™½)
                else { basePitch = 1.2; baseRate = 0.95; }
                
                u.rate = baseRate * speedMultiplier;
                u.pitch = basePitch;
                
                const voices = window.speechSynthesis.getVoices().filter(v => v.lang.includes('zh') || v.lang.includes('CN') || v.lang.includes('TW'));
                if (voices.length > 1 && role === 'a') u.voice = voices[1]; 

                u.onend = resolve;
                window.speechSynthesis.speak(u);
            });
        }

        let isAnswered = false;
        function checkAnswer(selectedIdx, btnElement) {
            if (isAnswered || isPlaying) return;
            const q = questionsData[currentIdx];
            const isCorrect = (selectedIdx === q.a);
            const feedback = document.getElementById('feedback');
            const allBtns = document.querySelectorAll('.option-btn');
            isAnswered = true;
            if (isCorrect) {
                btnElement.classList.add('correct');
                feedback.innerText = "ğŸ‰ ç­”å°äº†ï¼"; feedback.style.color = "green";
                score++; correctSound.currentTime = 0; correctSound.play();
            } else {
                btnElement.classList.add('wrong');
                feedback.innerText = "âŒ ç­”éŒ¯äº†ï¼"; feedback.style.color = "red";
                allBtns[q.a].classList.add('correct');
            }
            setTimeout(() => { currentIdx++; isAnswered = false; loadQuestion(); }, 2500);
        }

        function showResult() {
            document.getElementById('game-area').classList.add('hidden');
            document.getElementById('result-area').classList.remove('hidden');
            document.getElementById('result-title-display').innerText = settings.title;
            document.getElementById('result-name').innerText = studentName;
            document.getElementById('final-score').innerText = Math.round((score / questionsData.length) * 100);
            const d = new Date();
            document.getElementById('finish-date').innerText = `${d.getFullYear()}/${d.getMonth()+1}/${d.getDate()}`;
            victorySound.play();
            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
        }
    </script>
</body>
</html>
